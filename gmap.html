<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DUMP1090</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css" />
    <script src="http://10.0.1.18/js/jquery.min.js">
    </script>
    <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
    <style>
        /*黄色のアイコンのCSS  */
        .icon1 {
            width: 14px !important;
            height: 14px !important;
            border-radius: 10px;
            border: 1px solid #fdfdfd;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            background-color: rgb(255, 255, 0);
        }
    </style>
    <script>
	lat=35.65;
	lon=139.69;
        map=null;
        Planes={};
        function init() {
            map = L.map('mapcontainer');
            map.setView([lat, lon], 10);
            L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                attribution: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル</a>"
            }).addTo(map);
            window.setInterval(function() {
                fetchData();
            }, 1000);
        }
        function fetchData() {
            $.getJSON('/data.json', function(data) {
                var stillhere = {}
                for (var j=0; j < data.length; j++) {
                    var plane = data[j];
                    var marker = null;
                    stillhere[plane.hex] = true;
                    plane.flight = $.trim(plane.flight);
                    if (Planes[plane.hex]) {
                        Planes[plane.hex].marker.setTooltipContent(plane.flight);
                        Planes[plane.hex].marker.setLatLng([plane.lat, plane.lon]);
                    } else {
                        Planes[plane.hex] = plane;
                        var myIcon1 = L.divIcon({ className: 'icon1', iconAnchor: [13, 13] });
                        Planes[plane.hex].marker = L.marker([plane.lat, plane.lon], { icon: myIcon1 });
                        Planes[plane.hex].marker.addTo(map).bindTooltip(plane.flight);
;
                    }
                }
                /* Remove idle planes. */
                for (var p in Planes) {
                    if (!stillhere[p]) {
                        map.removeLayer(Planes[p].marker);
                        delete Planes[p];
                    }
                }
            });
        }
    </script>
</head>
<body onload="init()">
    <div id="mapcontainer" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
</body>

</html>
